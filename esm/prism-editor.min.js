function*t(t){const s=t.ownerDocument.getSelection(),i=function(t,n){if(!n||!n.intersectsNode(t))return;const s=t.ownerDocument.createRange();if(s.selectNode(t),-1===n.compareBoundaryPoints(Range.START_TO_START,s))return;if(1===n.compareBoundaryPoints(Range.END_TO_END,s))return;return{start:e(t,n.startContainer,n.startOffset),end:e(t,n.endContainer,n.endOffset)}}(t,1===s.rangeCount&&s.getRangeAt(0));yield i;const r=function(t,e){if(!e)return;const s=n(t,e.start),i=n(t,e.end);if(s&&i){const e=t.ownerDocument.createRange();return e.setStart(s[0],s[1]),e.setEnd(i[0],i[1]),e}}(t,i);r&&(s.removeAllRanges(),s.addRange(r))}function e(t,e,n){for(;e!==t;){const t=e;e=e.parentNode;for(const s of e.childNodes){if(s===t)break;n+=s.textContent.length}}return n}function n(t,e){if(e>t.textContent.length)return;let n=t.childNodes[0];for(;n;){const t=n.textContent.length;if(t<e)e-=t,n=n.nextSibling;else{if(3===n.nodeType)return[n,e];n=n.childNodes[0]}}}class s{constructor(t,e=null){this._duringUpdate=!1,this._stack=[e],this._ctrl=document.createElement("div"),this._ctrl.setAttribute("aria-hidden","true"),this._ctrl.style.opacity=0,this._ctrl.style.position="fixed",this._ctrl.style.top="-1000px",this._ctrl.style.pointerEvents="none",this._ctrl.tabIndex=-1,this._ctrl.contentEditable=!0,this._ctrl.textContent="0",this._ctrl.style.visibility="hidden",this._ctrl.addEventListener("focus",(t=>{window.setTimeout((()=>{this._ctrl.blur()}),0)})),this._ctrl.addEventListener("input",(e=>{this._duringUpdate||t(this.data);const n=window.getSelection();n.containsNode(this._ctrl,!0)&&n.removeAllRanges()}))}get _depth(){return+this._ctrl.textContent||0}get data(){return this._stack[this._depth]}push(t,e){this._ctrl.parentNode||(e||document.body).appendChild(this._ctrl);const n=this._depth+1;this._stack.splice(n,this._stack.length-n,t);const s=document.activeElement;try{this._duringUpdate=!0,this._ctrl.style.visibility=null,this._ctrl.focus(),document.execCommand("selectAll"),document.execCommand("insertText",!1,n)}finally{this._duringUpdate=!1,this._ctrl.style.visibility="hidden"}s&&s.focus()}}function i(e,n,i,a){!function(t,e){const n={...c,...e.attrs||{}};for(const e in n)t.setAttribute(e,n[e]);Object.assign(t.style,{...l,...e.style||{}})}(n,a),function(e,n,i){let r=new s(c,i);function c(t){const n=r;r=null;try{e._restore_state(t)}finally{r=n}}const l=function(t){let e,n=[];return s;function s(t){t&&n.push(t),void 0===e&&0!==n.length&&(e=requestAnimationFrame(i))}async function i(){let i=n;n=[];for(let e of i)await e.call(t);e=void 0,s()}}(e);let a=null;Object.assign(e,{*with_selection(){for(const e of t(n))yield},dirty(){l(e._refresh_selection),a=e._event_from_state(i),l(e.refresh_code)},_refresh_selection(){for(const t of e.with_selection())e.src_code=e.src_code+""},_emit_code_change(){o(e,a,"")},_emit_src_code(t,n,s=["lang","src_code"]){(function(t,e,n){for(const s of n)if(t[s]!==e[s])return!1;return!0})(n,i,s)||(i=n,null!==r&&r.push(e._save_state(n),t),a=e._event_from_state(i),l(e.refresh_code),o(e,a,":input"))}}),l(e.dirty),l(e._emit_code_change)}(e,n,i);const d=a.events||r,_=function(t,...e){const{table:n,attrs:s}=t;return t=>{const i=[`evt:${t.type}`,...s.map((e=>`${e}:${t[e]}`)).filter(Boolean)];for(let s=i.length;s>0;s--){const r=n[i.slice(0,s)];if(r)return r(t,...e)}}}(d,e,a);for(const t of d.keys)n.addEventListener(t,_);return()=>{for(const t of d.keys)n.removeEventListener(t,_)}}const r=Object.freeze({keys:Object.freeze(["keydown","keyup","paste","input","blur"]),attrs:Object.freeze(["key"]),table:Object.freeze({...function(){const t=new WeakSet;return{"evt:blur"(e,n){t.has(n)?e.preventDefault():n._emit_code_change()},async"evt:input"(e,n){if(!t.has(n)){t.add(n),await null;try{const t=n.src_code;for(const e of n.with_selection())document.execCommand("undo",!1),n.raw_src_code=t,n.dirty()}finally{t.delete(n)}}}}}(),"evt:keydown,key:Tab"(t,e,n){t.preventDefault(),document.execCommand("insertText",!1,n.tabs||"    ")},"evt:paste"(t,e){t.preventDefault();const n=t.clipboardData.getData("text/plain");n&&(document.execCommand("insertText",!1,n),e.dirty())}})});function o(t,e,n){if(e)return t.dispatchEvent(new CustomEvent("src_code"+n,{detail:e,bubbles:!0}))}const c={contentEditable:!0,spellcheck:!1},l={outline:"none",overflowWrap:"break-word",overflowY:"auto",resize:"vertical",whiteSpace:"pre-wrap"};class a extends HTMLElement{static with_options(t={}){return class extends(this){_dom_connect(e,n){i(this,e,n,t)}}}static define_with(t,e){let n=class extends(this){};return Object.assign(n.prototype,e),customElements.define(t,n),n}connectedCallback(){const t=this.textContent.replace(/^\s*\r?\n/,"");this.textContent="";const e={src_code:t,lang:this.lang},n=this._el_code=this._init_code_dom();this._dom_connect(n,e),this.src_code=t}_dom_connect(t,e){i(this,t,e,{})}disconnectedCallback(){this._dom_disconnect&&this._dom_disconnect()}_init_code_dom(t){let e=this.ownerDocument;const n=e.createElement("code"),s=e.createElement("pre");return s.appendChild(n),this.appendChild(s),t&&(s.className=t),n}static get observedAttributes(){return["lang","mode"]}attributeChangedCallback(){this.dirty()}dirty(){}get lang(){return this.getAttribute("lang")||this.default_lang||"js"}set lang(t){this.setAttribute("lang",t)}get raw_src_code(){return this._el_code.textContent}set raw_src_code(t){const{_el_code:e,lang:n}=this;this.render_code(n,t,e),this._emit_src_code(this,{src_code:t,lang:n})}get src_code(){return this._el_code.textContent}set src_code(t){this.raw_src_code=t,this.highlight_src(t,this._el_code)}_save_state(t){return t}_restore_state({lang:t,src_code:e}){this.lang=t,this.src_code=e}_event_from_state(t){return{...t}}render_code(t,e,n,s){if(n.innerText="",n.textContent=e,t){const e=`language-${t}`;n.classList.add(e),n.parentNode.classList.add(e)}return s&&this.highlight_src(e,n),n}highlight_src(t,e){globalThis.Prism&&Prism.highlightElement(e)}}function d(t,e){Prism.highlightElement(e)}function _(t){return(t.prototype||t).highlight_src=d,t}const h=a.define_with("prism-code-editor",{highlight_src:d});export{h as PrismCodeEditor,h as default,_ as with_prism};
//# sourceMappingURL=prism-editor.min.js.map
